create table
  public.brands (
    brand_id bigint generated by default as identity,
    created_at timestamp with time zone not null default now(),
    brand_name text not null,
    email text not null,
    password text not null,
    constraint brands_pkey primary key (brand_id),
    constraint brands_brand_name_key unique (brand_name)
  ) tablespace pg_default;

create table
  public.orders (
    id bigint generated by default as identity,
    created_at timestamp with time zone not null default now(),
    user_id bigint not null,
    shoe_id bigint not null,
    quantity integer not null default 1,
    constraint orders_pkey primary key (id),
    constraint orders_shoe_id_fkey foreign key (shoe_id) references shoes (shoe_id) on update cascade on delete cascade,
    constraint orders_user_id_fkey foreign key (user_id) references users (user_id) on update cascade on delete cascade
  ) tablespace pg_default;

create table
  public.point_ledger (
    id bigint generated by default as identity,
    created_at timestamp with time zone not null default now(),
    user_id bigint not null,
    point_change bigint not null,
    constraint point_ledger_pkey primary key (id),
    constraint point_ledger_user_id_fkey foreign key (user_id) references users (user_id) on update cascade on delete cascade
  ) tablespace pg_default;

create table
  public.prize_cart_items (
    created_at timestamp with time zone not null default now(),
    cart_id bigint not null,
    shoe_id bigint not null,
    quantity integer not null,
    constraint prize_cart_items_pkey primary key (cart_id, shoe_id),
    constraint prize_cart_items_cart_id_fkey foreign key (cart_id) references prize_carts (cart_id) on update cascade on delete cascade,
    constraint prize_cart_items_shoe_id_fkey foreign key (shoe_id) references shoes (shoe_id) on update cascade on delete cascade
  ) tablespace pg_default;

create table
  public.prize_carts (
    cart_id bigint generated by default as identity,
    created_at timestamp with time zone not null default now(),
    user_id bigint not null,
    active boolean not null default true,
    constraint prize_carts_pkey primary key (cart_id),
    constraint prize_carts_user_id_fkey foreign key (user_id) references users (user_id) on update cascade on delete cascade
  ) tablespace pg_default;

create table
  public.prize_ledger (
    id bigint generated by default as identity,
    created_at timestamp with time zone not null default now(),
    shoe_id bigint not null,
    change integer not null default 1,
    constraint prize_ledger_pkey primary key (id),
    constraint prize_ledger_shoe_id_fkey foreign key (shoe_id) references shoes (shoe_id) on update cascade on delete cascade
  ) tablespace pg_default;

create table
  public.raffle_entries (
    id bigint generated by default as identity,
    created_at timestamp with time zone not null default now(),
    user_id bigint not null,
    raffle_id bigint not null,
    constraint raffle_entries_pkey primary key (id),
    constraint raffle_entries_raffle_id_fkey foreign key (raffle_id) references raffles (raffle_id) on update cascade on delete cascade,
    constraint raffle_entries_user_id_fkey foreign key (user_id) references users (user_id) on update cascade on delete cascade
  ) tablespace pg_default;

create table
  public.raffles (
    raffle_id bigint generated by default as identity,
    start_time timestamp with time zone not null default now(),
    shoe_id bigint null,
    active boolean not null default true,
    constraint raffle_catalog_pkey primary key (raffle_id),
    constraint raffles_shoe_id_fkey foreign key (shoe_id) references shoes (shoe_id) on update cascade on delete cascade
  ) tablespace pg_default;

create table
  public.reviews (
    rating_id bigint generated by default as identity,
    created_at timestamp with time zone not null default now(),
    shoe_id bigint not null,
    user_id bigint not null,
    rating integer not null,
    comment text null,
    constraint reviews_pkey primary key (shoe_id, user_id),
    constraint reviews_shoe_id_fkey foreign key (shoe_id) references shoes (shoe_id) on update cascade on delete cascade,
    constraint reviews_user_id_fkey foreign key (user_id) references users (user_id) on update cascade on delete cascade,
    constraint ratings_comment_check check (
      (
        length(
          comment
        ) < 500
      )
    ),
    constraint ratings_rating_check check (
      (
        (rating >= 1)
        and (rating <= 5)
      )
    )
  ) tablespace pg_default;

create table
  public.shoes (
    shoe_id bigint generated by default as identity,
    created_at timestamp with time zone not null default now(),
    name text not null,
    brand text not null,
    price double precision not null,
    color text not null,
    material text null,
    tags text[] null,
    type text null,
    constraint shoes_pkey primary key (shoe_id)
  ) tablespace pg_default;

create table
  public.shoes_to_users (
    created_at timestamp with time zone not null default now(),
    shoe_id bigint not null,
    user_id bigint not null,
    constraint shoes_to_users_shoe_id_fkey foreign key (shoe_id) references shoes (shoe_id) on update cascade on delete cascade
  ) tablespace pg_default;

create table
  public.users (
    user_id bigint generated by default as identity,
    created_at timestamp with time zone not null default now(),
    name text not null,
    username text not null,
    email text not null,
    password bytea null,
    salt bytea null,
    is_logged_in boolean null,
    constraint Users_pkey primary key (user_id),
    constraint users_email_key unique (email),
    constraint users_user_id_key unique (user_id),
    constraint users_username_key unique (username)
  ) tablespace pg_default;

/*
Initially populated the shoes table with a .csv file.
This file is in the starter_files folder: shoes.csv
*/
